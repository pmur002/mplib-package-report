<html>
  <head>
<style type="text/css">
.knitr .inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage .left {
  text-align: left;
}
.rimage .right {
  text-align: right;
}
.rimage .center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <style type="text/css">
    @media print {
      body { }
      p.img { text-align: center; page-break-inside: avoid }
      img.CC { display: inline }
    }
    @media screen {
      body { max-width: 800px; margin: auto }
      p.img { text-align: center }
      img.CC { display: inline }
    }
    p.date {
      font-size: smaller;
      margin: 0;
    }
    p.versionHistory {
      color: gray
    }
    p.versionHistory a {
      color: gray
    }
    p.ref {
      text-indent: -2em;
      padding-left: 2em;
    }
  </style>
    <!-- PDFjs code (more at the end of the document) -->
    <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
  </head>
  <body>
    <h1>MetaPost Three Ways</h1>
    <p>
      <span style="font-style: italic">by Paul Murrell</span>
      <a href="http://orcid.org">
        <img alt="" src="https://www.stat.auckland.ac.nz/~paul/ORCID/ORCiD.png" style="width: 16px; height: 16px; vertical-align: middle">
      </a>
      <span style="font-family: mono; font-size: small">
        <a href="http://orcid.org/0000-0002-3224-8858">http://orcid.org/0000-0002-3224-8858</a>
      </span>
    </p>
    <p class="date">
    Version 1:
Wednesday 07 November 2018
  </p>


    <hr>
    <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img class="CC" alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">This document</span>
    by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Paul
    Murrell</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative
    Commons Attribution 4.0 International License</a>.
  </p>
    <hr>
    <p>
    This report describes three different approaches to communicating
    between R and MetaPost: importing the PostScript output from MetaPost;
    calling the <code>mpost</code> program to solve MetaPost paths;
    and calling the <code>mplib</code> library to solve MetaPost paths.
  </p>
    <div>
      <h2>Table of Contents:</h2>
      <ul style="list-style: none">
        <li>
          <a href="#intro">1. Introduction</a>
        </li>
        <li>
          <a href="#paths">2. Describing MetaPost paths in R</a>
        </li>
        <li>
          <a href="#grimport">3. Importing MetaPost PostScript output</a>
        </li>
        <li>
          <a href="#metapost">4. Tracing MetaPost log output</a>
        </li>
        <li>
          <a href="#mplib">5. Calling the MPLib library</a>
        </li>
        <li>
          <a href="#integrate">6. Integrating R and MetaPost graphics</a>
        </li>
        <li>
          <a href="#summary">7. Summary</a>
        </li>
        <li>
          <a href="#discussion">8. discussion</a>
        </li>
        <li>
          <a href="#requirements">9. Technical requirements</a>
        </li>
        <li>
          <a href="#Resources">10. Resources</a>
        </li>
        <li>
          <a href="#references">11. References</a>
        </li>
      </ul>
    </div>
    <h2>
      <a name="intro">1. Introduction</a>
    </h2>
    <p>
    MetaPost (<a href="#metapost-hobby">Hobby, 1998</a>) 
    is a graphics system that provides some very useful 
    features for describing curves.  For example, the 
    following MetaPost code describes an infinity symbol 
    from only four points:  the path will pass horizontally from left
    to right through the first point (bottom-left), then the second point
    (top-right), then curve around and pass horizontally
    from right to left through the third point (bottom-right), then
    the fourth point (top-left), and finally curve around back to 
    the starting point.
  </p>
<div class="chunk" id="unnamed-chunk-3"><div class="rcode"><div class="output"><pre class="knitr r">  beginfig(1);
  z0 = (0, 0);
  z1 = (20, 10);
  z2 = (20, 0);
  z3 = (0, 10);
  draw z0{dir 0}..z1{dir 0}..z2{dir 180}..z3{dir 180}..cycle;
  endfig;
  end
</pre></div>
</div></div>
    <p>
    One way to use MetaPost is to write a standalone file 
    containing MetaPost code (the code above is stored in a file
    called <code>infinity.mp</code>).  This can then be processed 
    using the <code>mpost</code> program to produce a PostScript, or PNG,
    or SVG
    file containing the drawn curve.  Typing the expression
    below (in a shell)
    produces an SVG file <code>infinity.svg</code>,
    which is shown below the <code>mpost</code> command.
  </p>
<div class="chunk" id="unnamed-chunk-4"><div class="rcode"><div class="output"><pre class="knitr r">  mpost -s outputformat=&quot;svg&quot; -s outputtemplate=&quot;%j.svg&quot; infinity.mp
</pre></div>
</div></div>
    <img src="infinity.svg" style="border: solid 1pt; padding: 10pt">
    <p>
    The MetaPost system is often used in association with TeX documents.
    Another approach to using MetaPost is to include MetaPost code directly
    within a LaTeX document, as shown in the following code.  
  </p>
<div class="chunk" id="unnamed-chunk-5"><div class="rcode"><div class="output"><pre class="knitr r">  \documentclass[border={2pt 2pt 2pt 2pt}]{standalone}
  \usepackage{luamplib}
  \usepackage{hologo}
  \begin{document}
  \hologo{METAPOST} in a \LaTeX document:
  \begin{mplibcode}
  beginfig(1);
  z0 = (0, 0);
  z1 = (20, 10);
  z2 = (20, 0);
  z3 = (0, 10);
  draw z0{dir 0}..z1{dir 0}..z2{dir 180}..z3{dir 180}..cycle;
  endfig;
  \end{mplibcode}
  \end{document}
</pre></div>
</div></div>
    <p>
    This LaTeX document must be processed with the <code>lualatex</code>
    engine (<a href="#luatex">The LuaTeX development team, 2017</a>)
    (rather than, for example, <code>pdflatex</code>), but this automatically
    generates and embeds the MetaPost image in the resulting
    PDF document  (the resulting
    PDF document is shown below the code).
  </p>
<div class="chunk" id="unnamed-chunk-6"><div class="rcode"><div class="output"><pre class="knitr r">  lualatex infinity-doc.tex
</pre></div>
</div></div>
    <canvas id="infinity-doc" class="pdf" style="border: solid 1pt; padding: 10pt"></canvas>
    <p>
    The ConTeXt system (<a href="#context">Hagen, 2018</a>) 
    also allows embedded MetaPost code.
  </p>
    <p>
    This report considers the problem of integrating MetaPost 
    with R (<a href="#R">R Core Team, 2018</a>).  More specifically, we will look at incorporating
    MetaPost curves within R graphical output.
    Although it is also possible to draw text labels within MetaPost images,
    this work focuses mostly on the curve-drawing facilities of MetaPost.
  </p>
    <p>
    This report will describe three different 
    interfaces to MetaPost that are based on three R packages:
    'grImport', 'metapost', and 'mplib'.
  </p>
<div class="chunk" id="unnamed-chunk-7"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(grImport)</span>
<span class="hl kwd">library</span><span class="hl std">(metapost)</span>
<span class="hl kwd">library</span><span class="hl std">(mplib)</span>
</pre></div>
</div></div>
    <h2>
      <a name="paths">2. Describing MetaPost paths in R</a>
    </h2>
    <p>
    Our goal is to produce graphical
    output in R, with assistance from MetaPost to produce curves.
    The first step is to describe a MetaPost curve within R.
  </p>
    <p>
    Rather than write MetaPost code directly, the 'metapost'
    package provides functions that allow us to construct a 
    MetaPost path in R code.  For example, the following code
    describes the infinity symbol path that we saw earlier.
  </p>
<div class="chunk" id="unnamed-chunk-8"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">p</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">20</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span>
     <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">20</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">180</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">180</span><span class="hl std">)</span> <span class="hl opt">+</span>
     <span class="hl kwd">cycle</span><span class="hl std">()</span>
</pre></div>
</div></div>
    <p>
    The result is a "path" object, which prints out a MetaPost
    equivalent ...
  </p>
<div class="chunk" id="unnamed-chunk-9"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">p</span>
</pre></div>
<div class="output"><pre class="knitr r">  (0in,0in){dir 0}..(0.28in,0.14in){dir 0}..(0.28in,0in){dir 180}..(0in,0.14in){dir 180}..cycle
</pre></div>
</div></div>
    <p>
    ... and can be used to draw the infinity symbol in R
    (the <code>grid.metapost</code> function will be described later).
  </p>
<div class="chunk" id="grid.metaplot"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">grid.metapost</span><span class="hl std">(p)</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-10"><div class="rimage default"><img src="figure/unnamed-chunk-10-1.png" title="plot of chunk unnamed-chunk-10" alt="plot of chunk unnamed-chunk-10" class="plot" /></div></div>
    <p>
    The basic structure of any path is a set of knot locations,
    which are defined using the <code>knot</code> function.
    Additional information can be provided in the call to 
    <code>knot</code>. For example, we can specify the
    (right) direction of the knot as shown below.
  </p>
<div class="chunk" id="unnamed-chunk-11"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">dir.right</span><span class="hl std">=</span><span class="hl num">0</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">  (0in,0in){dir 0}
</pre></div>
</div></div>
    <p>
    In addition to direction, it is possible to specify 
    tension, curl, and explicit control points (both left and right)
    in the call to <code>knot</code>.  However, it may be more readable
    to use the separate "connector" 
    functions that specify direction (<code>dir</code>),
    tension (<code>tension</code>), curl (<code>curl</code>), and
    control points (<code>cp</code>) and combine them all using the
    <code>+</code> operator.  For example, the following two
    expressions are equivalent.
  </p>
<div class="chunk" id="unnamed-chunk-12"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwc">dir.right</span><span class="hl std">=</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl kwc">dir.left</span><span class="hl std">=</span><span class="hl num">0</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">  (0in,0in){dir 0}..{dir 0}(0.01in,0.01in)
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">  (0in,0in){dir 0}..{dir 0}(0.01in,0.01in)
</pre></div>
</div></div>
    <p>
    There is also the function <code>cycle</code> to indicate that
    the path is a closed path (this was used in the infinity symbol above.
  </p>
    <p>
    In addition to the <code>+</code> operator for combining knots,
    there are <code>-</code>, <code>%+%</code>, and <code>%-%</code> operators.
    These correspond to the <code>--</code> (straight line), 
    <code>...</code> (inflection-free path), and
    <code>---</code> (straight line with smooth connection) 
    operators in MetaPost.
    These operators may only be used between two knots (not between a 
    call to <code>knot</code>
    and a call to one of the connector functions like <code>dir</code>).
  </p>
    <p>
    The locations of knots (and control points) can be specified
    using any coordinate system from the 'grid' package, either
    via the <code>unit</code> function, or the <code>units</code> 
    argument to <code>knot</code>, or by setting the 
    <code>metapost.units</code> option.
    For example, the following expressions are all equivalent.
  </p>
<div class="chunk" id="unnamed-chunk-13"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">options</span><span class="hl std">(</span><span class="hl kwc">metapost.units</span><span class="hl std">=</span><span class="hl str">&quot;npc&quot;</span><span class="hl std">)</span>
<span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">  (7in,7in)
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;npc&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">  (7in,7in)
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;npc&quot;</span><span class="hl std">),</span> <span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;npc&quot;</span><span class="hl std">))</span>
</pre></div>
<div class="output"><pre class="knitr r">  (7in,7in)
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">options</span><span class="hl std">(</span><span class="hl kwc">metapost.units</span><span class="hl std">=</span><span class="hl str">&quot;pt&quot;</span><span class="hl std">)</span>
</pre></div>
</div></div>
    <p>
    The benefit of the more verbose forms is finer control.  For example,
    with the last form,
    it is possible to specify the x-location of a knot relative to
    a different coordinate system than the y-location of the knot.
  </p>
<div class="chunk" id="unnamed-chunk-14"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;npc&quot;</span><span class="hl std">),</span> <span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">))</span>
</pre></div>
<div class="output"><pre class="knitr r">  (7in,1in)
</pre></div>
</div></div>
    <h2>
      <a name="grimport">3. Importing MetaPost PostScript output</a>
    </h2>
    <p>
    Having defined a MetaPost path in R, the next step 
    is to draw the path.  One way to do this is to use
    the <code>mpost</code> program to draw the curve as a PostScript
    image and then import the PostScript image with the 'grImport' package.
    The 'metapost' package provides two functions to help with this
    approach.  
  </p>
    <p>
    The <code>metapost</code> function can be used to
    convert the MetaPost path in R into a MetaPost file.
  </p>
<div class="chunk" id="unnamed-chunk-15"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">options</span><span class="hl std">(</span><span class="hl kwc">metapost.units</span><span class="hl std">=</span><span class="hl str">&quot;in&quot;</span><span class="hl std">)</span>
<span class="hl std">scurve</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">)</span>
<span class="hl std">scurve</span>
</pre></div>
<div class="output"><pre class="knitr r">  (0in,0in){dir 0}..{dir 0}(1in,1in)
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl std">mpcode</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">metapost</span><span class="hl std">(scurve,</span> <span class="hl str">&quot;scurve.mp&quot;</span><span class="hl std">)</span>
</pre></div>
</div></div>
    <p> 
    The result returned by <code>metapost</code> is a character version
    of the MetaPost code that it wrote to the MetaPost file.
  </p>
<div class="chunk" id="unnamed-chunk-16"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">cat</span><span class="hl std">(mpcode,</span> <span class="hl kwc">sep</span><span class="hl std">=</span><span class="hl str">&quot;\n&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">  beginfig(1);
  draw (0in,0in){dir 0}..{dir 0}(1in,1in);
  endfig;
  end
</pre></div>
</div></div>
    <p>
    The <code>mpost</code> function can be used to run the <code>mpost</code>
    program on a file.
  </p>
<div class="chunk" id="unnamed-chunk-17"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">mpost</span><span class="hl std">(</span><span class="hl str">&quot;scurve.mp&quot;</span><span class="hl std">)</span>
</pre></div>
</div></div>
    <p>
    This produces a PostScript file, <code>"scurve.1"</code> in this case, 
    which we can import and
    draw using 'grImport'.
  </p>
<div class="chunk" id="unnamed-chunk-18"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(grImport)</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-19"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">PostScriptTrace</span><span class="hl std">(</span><span class="hl str">&quot;scurve.1&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;scurve.xml&quot;</span><span class="hl std">)</span>
<span class="hl std">scurvePic</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">readPicture</span><span class="hl std">(</span><span class="hl str">&quot;scurve.xml&quot;</span><span class="hl std">)</span>
<span class="hl kwd">grid.picture</span><span class="hl std">(scurvePic)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-19-1.png" title="plot of chunk unnamed-chunk-19" alt="plot of chunk unnamed-chunk-19" class="plot" /></div></div>
    <h2>
      <a name="metapost">4. Tracing MetaPost log output</a>
    </h2>
    <p>
    In the previous section, we had <code>mpost</code> both
    <em>solve</em> and <em>draw</em> a MetaPost path 
    and then we imported the drawing.  
    Another option is to use <code>mpost</code> just to <em>solve</em>
    the path, but to do the drawing in R.
    This is the purpose of the <code>mptrace</code> function
    (from the 'metapost' package).  
  </p>
    <p>
    The <code>mptrace</code> function works 
    with the output from a "log" file that is produced by <code>mpost</code>.
    When we call the <code>mpost</code> function with <code>tracing=TRUE</code>
    (the default), <code>mpost</code> produces a PostScript file
    (<code>"scurve.1"</code> in the example above) and a log file
    (<code>"scurve.log"</code> in the example above).  The log file
    contains information about the Bezier curves that MetaPost has
    chosen in order to represent the MetaPost path.
    The <code>mptrace</code> function reads that log information into
    R.  Note that the locations of the control points for the Bezier
    curves are given in "big points" (or "printer's points"), which
    are 1/72 inches.
  </p>
<div class="chunk" id="unnamed-chunk-20"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">scurveTraced</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">mptrace</span><span class="hl std">(</span><span class="hl str">&quot;scurve.log&quot;</span><span class="hl std">)</span>
<span class="hl std">scurveTraced</span>
</pre></div>
<div class="output"><pre class="knitr r">  [[1]]
  $x
  [1]  0.0000 39.7645 32.2355 72.0000
  
  $y
  [1]  0  0 72 72
  
  attr(,&quot;class&quot;)
  [1] &quot;mpcontrols&quot;
  
  attr(,&quot;class&quot;)
  [1] &quot;mpcontrolList&quot;
</pre></div>
</div></div>
    <p>
    The <code>grid.metapost</code> function (from the 'metapost' package)
    can take that path information and draw the appropriate Bezier curve.
  </p>
<div class="chunk" id="unnamed-chunk-21"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">grid.metapost</span><span class="hl std">(scurveTraced)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-21-1.png" title="plot of chunk unnamed-chunk-21" alt="plot of chunk unnamed-chunk-21" class="plot" /></div></div>
    <p>
    The <code>grid.metapost</code> function will also accept a
    MetaPost path directly, 
    in which case it performs all of the necessary steps,
    calling <code>metapost</code> to create a MetaPost file,
    calling <code>mpost</code> to produce log output, 
    calling <code>mptrace</code> to read the log output, and
    then drawing the final result.
  </p>
<div class="chunk" id="unnamed-chunk-22"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">grid.metapost</span><span class="hl std">(scurve)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-22-1.png" title="plot of chunk unnamed-chunk-22" alt="plot of chunk unnamed-chunk-22" class="plot" /></div></div>
    <h3>Coordinate systems</h3>
    <p>
    A MetaPost path in R can be specified using any 'grid'
    coordinate system, but the MetaPost code that the path
    is converted into is described in terms of inches.
    The 'grid' coordinate systems are always relative to the
    current 'grid' viewport, so the meaning of a location
    like <code>unit(1, "npc")</code>, in terms of inches,
    depends on the current viewport.
    In other words, the physical size of the MetaPost path is
    fixed at the moment that it is converted to MetaPost code.
  </p>
    <p>
    This should not cause any difficulty if we call
    <code>grid.metapost</code> directly on a MetaPost path,
    because the conversion to MetaPost code and the drawing of
    the solved path will happen at once, in the same viewport.
  </p>
    <p>
    However, if we call <code>metapost</code> (and <code>mpost</code>
    and <code>mptrace</code>) ourselves, for example, so that we can
    reuse the same path in multiple places, we need to be aware that
    the physical size of the path will be fixed no matter where
    we draw it.
  </p>
    <p>
    The following code demonstrates this idea by drawing
    a MetaPost path in two different viewports, one smaller and
    one larger.  The (thin, opaque) black 
    lines are drawn by calling <code>grid.metapost</code>
    directly on the path, so they resize with the viewport.
    The (thick, semitransparent)
    red lines are drawn by calling <code>metapost</code>
    within the first viewport and calling <code>grid.metapost</code>
    on the solved path, so it remains at the smaller size in the larger
    viewport.
  </p>
<div class="chunk" id="unnamed-chunk-23"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">options</span><span class="hl std">(</span><span class="hl kwc">metapost.units</span><span class="hl std">=</span><span class="hl str">&quot;npc&quot;</span><span class="hl std">)</span>
<span class="hl std">p</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">)</span>
<span class="hl kwd">pushViewport</span><span class="hl std">(</span><span class="hl kwd">viewport</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">,</span> <span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">),</span> <span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">),</span>
                      <span class="hl kwc">just</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;left&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;bottom&quot;</span><span class="hl std">)))</span>
<span class="hl kwd">grid.rect</span><span class="hl std">(</span><span class="hl kwc">gp</span><span class="hl std">=</span><span class="hl kwd">gpar</span><span class="hl std">(</span><span class="hl kwc">col</span><span class="hl std">=</span><span class="hl num">NA</span><span class="hl std">,</span> <span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl str">&quot;grey80&quot;</span><span class="hl std">))</span>
<span class="hl kwd">grid.metapost</span><span class="hl std">(p)</span>
<span class="hl kwd">metapost</span><span class="hl std">(p,</span> <span class="hl str">&quot;fixed.mp&quot;</span><span class="hl std">)</span>
<span class="hl kwd">mpost</span><span class="hl std">(</span><span class="hl str">&quot;fixed.mp&quot;</span><span class="hl std">)</span>
<span class="hl std">fixed</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">mptrace</span><span class="hl std">(</span><span class="hl str">&quot;fixed.log&quot;</span><span class="hl std">)</span>
<span class="hl kwd">grid.metapost</span><span class="hl std">(fixed,</span> <span class="hl kwc">gp</span><span class="hl std">=</span><span class="hl kwd">gpar</span><span class="hl std">(</span><span class="hl kwc">col</span><span class="hl std">=</span><span class="hl kwd">rgb</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">.5</span><span class="hl std">),</span> <span class="hl kwc">lwd</span><span class="hl std">=</span><span class="hl num">3</span><span class="hl std">))</span>
<span class="hl kwd">popViewport</span><span class="hl std">()</span>
<span class="hl kwd">pushViewport</span><span class="hl std">(</span><span class="hl kwd">viewport</span><span class="hl std">(</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1.5</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">),</span> <span class="hl num">0</span><span class="hl std">,</span>
                      <span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">),</span> <span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">2</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">),</span>
                      <span class="hl kwc">just</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;left&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;bottom&quot;</span><span class="hl std">)))</span>
<span class="hl kwd">grid.rect</span><span class="hl std">(</span><span class="hl kwc">gp</span><span class="hl std">=</span><span class="hl kwd">gpar</span><span class="hl std">(</span><span class="hl kwc">col</span><span class="hl std">=</span><span class="hl num">NA</span><span class="hl std">,</span> <span class="hl kwc">fill</span><span class="hl std">=</span><span class="hl str">&quot;grey80&quot;</span><span class="hl std">))</span>
<span class="hl kwd">grid.metapost</span><span class="hl std">(p)</span>
<span class="hl kwd">grid.metapost</span><span class="hl std">(fixed,</span> <span class="hl kwc">gp</span><span class="hl std">=</span><span class="hl kwd">gpar</span><span class="hl std">(</span><span class="hl kwc">col</span><span class="hl std">=</span><span class="hl kwd">rgb</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">0</span><span class="hl std">,</span><span class="hl num">.5</span><span class="hl std">),</span> <span class="hl kwc">lwd</span><span class="hl std">=</span><span class="hl num">3</span><span class="hl std">))</span>
<span class="hl kwd">popViewport</span><span class="hl std">()</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-23-1.png" title="plot of chunk unnamed-chunk-23" alt="plot of chunk unnamed-chunk-23" class="plot" /></div></div>
    <h3>Accuracy</h3>
    <p>
    When knot locations in 'grid' coordinates are converted
    to inches in MetaPost code, the values are rounded
    (by default to 2 decimal places).
    More decimal places can be retained via the <code>digits</code>
    argument to <code>metapost</code> (or to <code>grid.metapost</code>
    if we give it a path directly).
  </p>
<div class="chunk" id="unnamed-chunk-24"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">p</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;cm&quot;</span><span class="hl std">)</span>
<span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl kwd">metapost</span><span class="hl std">(p),</span> <span class="hl kwc">sep</span><span class="hl std">=</span><span class="hl str">&quot;\n&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">  beginfig(1);
  draw (0in,0in){dir 0}..{dir 0}(0.39in,0.39in);
  endfig;
  end
</pre></div>
<div class="source"><pre class="knitr r"><span class="hl kwd">cat</span><span class="hl std">(</span><span class="hl kwd">metapost</span><span class="hl std">(p,</span> <span class="hl kwc">digits</span><span class="hl std">=</span><span class="hl num">4</span><span class="hl std">),</span> <span class="hl kwc">sep</span><span class="hl std">=</span><span class="hl str">&quot;\n&quot;</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">  beginfig(1);
  draw (0in,0in){dir 0}..{dir 0}(0.3937in,0.3937in);
  endfig;
  end
</pre></div>
</div></div>
    <h2>
      <a name="mplib">5. Calling the MPLib library</a>
    </h2>
    <p>
    The approach described in the previous section
    involves creating a MetaPost path in R,
    writing a MetaPost file 
    (with <code>metapost</code>), then generating a log file 
    (with <code>mpost</code>), and finally
    reading the log file back into R (with <code>mptrace</code>).
  </p>
    <p>
    That approach involves both reading and writing to the file
    system.  An alternative is provided by the 'mplib' package,
    which provides an interface to the <code>mplib</code> MetaPost
    library (<a href="#mplibapi">Hoekwater and Scarso, 2018</a>) and allows us to work entirely in resident 
    memory.
  </p>
    <p>
    The <code>mpsolve</code> function from the 'mplib' package
    takes a MetaPost path and uses calls to <code>mplib</code> 
    to solve the path.  The result is a set of Bezier curve control
    points (similar to the <code>mptrace</code> function from
    'metapost').
  </p>
<div class="chunk" id="unnamed-chunk-25"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(mplib)</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-26"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">scurveSolved</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">mpsolve</span><span class="hl std">(scurve)</span>
<span class="hl std">scurveSolved</span>
</pre></div>
<div class="output"><pre class="knitr r">  [[1]]
  $x
  [1]  0.0000 39.7645 32.2355 72.0000
  
  $y
  [1]  0  0 72 72
  
  attr(,&quot;class&quot;)
  [1] &quot;mpcontrols&quot;
  
  attr(,&quot;class&quot;)
  [1] &quot;mpcontrolList&quot;
</pre></div>
</div></div>
    <p>
    The <code>grid.mplib</code> function (from 'mplib') 
    takes the solved path and draws the appropriate Bezier curves.
  </p>
<div class="chunk" id="unnamed-chunk-27"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">grid.mplib</span><span class="hl std">(scurveSolved)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-27-1.png" title="plot of chunk unnamed-chunk-27" alt="plot of chunk unnamed-chunk-27" class="plot" /></div></div>
    <p>
    As with <code>grid.metapost</code>, <code>grid.mplib</code> will
    also accept a MetaPost path directly (and calls
    <code>mpsolve</code> itself).
  </p>
<div class="chunk" id="unnamed-chunk-28"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">grid.mplib</span><span class="hl std">(scurve)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-28-1.png" title="plot of chunk unnamed-chunk-28" alt="plot of chunk unnamed-chunk-28" class="plot" /></div></div>
    <p>
    The value returned by <code>mpsolve</code> is compatible
    with the value returned by <code>mptrace</code>, so it can
    also be passed to <code>grid.metapost</code> for drawing.
  </p>
<div class="chunk" id="unnamed-chunk-29"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">grid.metapost</span><span class="hl std">(scurveSolved)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-29-1.png" title="plot of chunk unnamed-chunk-29" alt="plot of chunk unnamed-chunk-29" class="plot" /></div></div>
    <p>
    The MetaPath description in R, which is described in terms
    of 'grid' coordinates, is converted to "big points" (1/72 inches)
    in the call to <code>mpsolve</code>.  This means that 
    the physical size of the solved path is dependent on the 'grid' 
    viewport in effect when <code>mpsolve</code> is called.
  </p>
    <h3>System requirements for 'mplib'</h3>
    <p>
    An important limitation of the 'mplib' package is that
    it is built upon a shared library called <code>libmplib.so</code>
    and, unfortunately, that library does not exist publicly.
    However, steps to build the shared library are
    given in <a href="#murrell-mplib-library-2018">Murrell, 2018a</a> and those
    instructions are encoded in a 
    <a href="MetaPost-shared/Dockerfile">Dockerfile</a> 
    (which has been used to produce the Docker image 
    <a href="https://hub.docker.com/r/pmur002/mplib-shared/">pmur002/mplib-shared</a>).
  </p>
    <h2>
      <a name="integrate">6. Integrating R and MetaPost graphics</a>
    </h2>
    <p>
    The point of being able to import MetaPost paths into R
    is not just so that we can replicate a MetaPost image.
    The value in being able to import MetaPost paths into R
    is that this allows us to combine the strengths of MetaPost
    graphics with the strengths of R graphics.
  </p>
    <p>
    As a simple example, the following code makes use of a 
    MetaPost path to connect a label with a data point
    in a 'lattice' plot (<a href="#lattice"></a>).  MetaPost makes it easy to
    describe the curve and R makes it easy to describe the plot.
  </p>
<div class="chunk" id="unnamed-chunk-30"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(lattice)</span>
<span class="hl kwd">xyplot</span><span class="hl std">(mpg</span> <span class="hl opt">~</span> <span class="hl std">disp, mtcars)</span>
<span class="hl std">x</span> <span class="hl kwb">&lt;-</span> <span class="hl std">mtcars</span><span class="hl opt">$</span><span class="hl std">disp[</span><span class="hl num">1</span><span class="hl std">]</span>
<span class="hl std">y</span> <span class="hl kwb">&lt;-</span> <span class="hl std">mtcars</span><span class="hl opt">$</span><span class="hl std">mpg[</span><span class="hl num">1</span><span class="hl std">]</span>
<span class="hl std">lab</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">rownames</span><span class="hl std">(mtcars)[</span><span class="hl num">1</span><span class="hl std">]</span>
<span class="hl kwd">downViewport</span><span class="hl std">(</span><span class="hl str">&quot;plot_01.panel.1.1.vp&quot;</span><span class="hl std">)</span>
<span class="hl kwd">grid.picture</span><span class="hl std">(scurvePic,</span>
             <span class="hl kwc">x</span><span class="hl std">=</span><span class="hl kwd">unit</span><span class="hl std">(x,</span> <span class="hl str">&quot;native&quot;</span><span class="hl std">),</span> <span class="hl kwc">y</span><span class="hl std">=</span><span class="hl kwd">unit</span><span class="hl std">(y,</span> <span class="hl str">&quot;native&quot;</span><span class="hl std">),</span>
             <span class="hl kwc">width</span><span class="hl std">=</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">),</span> <span class="hl kwc">height</span><span class="hl std">=</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">),</span>
             <span class="hl kwc">just</span><span class="hl std">=</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;left&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;bottom&quot;</span><span class="hl std">),</span> <span class="hl kwc">exp</span><span class="hl std">=</span><span class="hl num">0</span><span class="hl std">)</span>
<span class="hl kwd">grid.text</span><span class="hl std">(lab,</span>
          <span class="hl kwd">unit</span><span class="hl std">(x,</span> <span class="hl str">&quot;native&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">),</span>
          <span class="hl kwd">unit</span><span class="hl std">(y,</span> <span class="hl str">&quot;native&quot;</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">),</span>
          <span class="hl kwc">just</span><span class="hl std">=</span><span class="hl str">&quot;left&quot;</span><span class="hl std">)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-30-1.png" title="plot of chunk unnamed-chunk-30" alt="plot of chunk unnamed-chunk-30" class="plot" /></div></div>
    <p>
    Another example of combining graphics facilities in R
    with MetaPost is to use MetaPost to define a set of Bezier
    control points for a path and then use the R package 'vwline'
    (<a href="#pkg:vwline">Murrell, 2018c</a>)
    to draw a variable-width version of that path.
    The following code defines a MetaPost path and uses
    <code>metapost</code>, <code>mpost</code>, and 
    <code>mptrace</code> to generate Bezier control points
    for the solved path.  We then draw a variable-width Bezier
    curve based on those control points (with <code>grid.offsetBezier</code>
    from the 'vwline' package).
  </p>
<div class="chunk" id="unnamed-chunk-31"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(grid)</span>
<span class="hl kwd">library</span><span class="hl std">(vwline)</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-32"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">options</span><span class="hl std">(</span><span class="hl kwc">metapost.units</span><span class="hl std">=</span><span class="hl str">&quot;npc&quot;</span><span class="hl std">)</span>
<span class="hl std">p</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">)</span>
<span class="hl kwd">metapost</span><span class="hl std">(p,</span> <span class="hl str">&quot;fig.mp&quot;</span><span class="hl std">)</span>
<span class="hl kwd">mpost</span><span class="hl std">(</span><span class="hl str">&quot;fig.mp&quot;</span><span class="hl std">,</span> <span class="hl kwc">tracing</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl std">controls</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">mptrace</span><span class="hl std">(</span><span class="hl str">&quot;fig.log&quot;</span><span class="hl std">)[[</span><span class="hl num">1</span><span class="hl std">]]</span>
<span class="hl kwd">grid.offsetBezier</span><span class="hl std">(controls</span><span class="hl opt">$</span><span class="hl std">x, controls</span><span class="hl opt">$</span><span class="hl std">y,</span> <span class="hl kwc">default.units</span><span class="hl std">=</span><span class="hl str">&quot;pt&quot;</span><span class="hl std">,</span>
                  <span class="hl kwc">w</span><span class="hl std">=</span><span class="hl kwd">widthSpline</span><span class="hl std">(</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">5</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">),</span> <span class="hl str">&quot;mm&quot;</span><span class="hl std">),</span> <span class="hl kwc">shape</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-32-1.png" title="plot of chunk unnamed-chunk-32" alt="plot of chunk unnamed-chunk-32" class="plot" /></div></div>
    <p>
    The recent addition of the 'gridBezier' package 
    (<a href="#pkg:gridbezier">Murrell, 2018b</a>)
    means that this also works for Bezier splines, which
    consist of more than one Bezier curve.  The following code
    draws a variable-width version of the 
    infinity symbol that we began with.
  </p>
<div class="chunk" id="unnamed-chunk-33"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">options</span><span class="hl std">(</span><span class="hl kwc">metapost.units</span><span class="hl std">=</span><span class="hl str">&quot;mm&quot;</span><span class="hl std">)</span>
<span class="hl std">p</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">20</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span>
     <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">20</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">180</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">10</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">180</span><span class="hl std">)</span> <span class="hl opt">+</span>
     <span class="hl kwd">cycle</span><span class="hl std">()</span>
<span class="hl kwd">pushViewport</span><span class="hl std">(</span><span class="hl kwd">viewport</span><span class="hl std">(</span><span class="hl kwc">width</span><span class="hl std">=</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">),</span> <span class="hl kwc">height</span><span class="hl std">=</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">)))</span>
<span class="hl kwd">metapost</span><span class="hl std">(p,</span> <span class="hl str">&quot;fig.mp&quot;</span><span class="hl std">)</span>
<span class="hl kwd">mpost</span><span class="hl std">(</span><span class="hl str">&quot;fig.mp&quot;</span><span class="hl std">,</span> <span class="hl kwc">tracing</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl std">controls</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">mptrace</span><span class="hl std">(</span><span class="hl str">&quot;fig.log&quot;</span><span class="hl std">)[[</span><span class="hl num">1</span><span class="hl std">]]</span>
<span class="hl kwd">grid.offsetBezier</span><span class="hl std">(controls</span><span class="hl opt">$</span><span class="hl std">x, controls</span><span class="hl opt">$</span><span class="hl std">y,</span> <span class="hl kwc">default.units</span><span class="hl std">=</span><span class="hl str">&quot;pt&quot;</span><span class="hl std">,</span>
                  <span class="hl kwc">open</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">,</span>
                  <span class="hl kwc">w</span><span class="hl std">=</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl kwd">c</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">,</span> <span class="hl num">3</span><span class="hl std">),</span> <span class="hl str">&quot;mm&quot;</span><span class="hl std">))</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-33-1.png" title="plot of chunk unnamed-chunk-33" alt="plot of chunk unnamed-chunk-33" class="plot" /></div></div>
    <p>
    As a final example of mixing R graphics and MetaPost graphics,
    the width of a variable-width Bezier spline in 'vwline' can itself be
    described by a Bezier spline.  The following code
    uses MetaPost to generate Bezier control points for specifying
    the width of a variable-width line.
    The diagram below the code
    shows the Bezier spline that we have defined.  The left edge
    of the diagram represents the start of the variable-width line
    and the right edge of the diagram represents the end
    of the variable-width line;  the height of the black line
    represents the width of the variable-width line.
    <!--
    NOTE the use of <code>dir(NA)</code> to place a non-specific
    direction AFTER the second-to-last knot so that the subsequent
    <code>dir(0)</code> becomes a direction for the last knot.
    Another way to do that would be <code>knot(9, 2, dir.left=0)</code> (?)
    -->
  </p>
<div class="chunk" id="unnamed-chunk-34"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">options</span><span class="hl std">(</span><span class="hl kwc">metapost.units</span><span class="hl std">=</span><span class="hl str">&quot;mm&quot;</span><span class="hl std">)</span>
<span class="hl std">widthPath</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">2</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">3</span><span class="hl std">,</span> <span class="hl num">2</span><span class="hl std">)</span> <span class="hl opt">+</span>
             <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">6</span><span class="hl std">,</span> <span class="hl num">1</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">NA</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">9</span><span class="hl std">,</span> <span class="hl num">2</span><span class="hl std">)</span>
<span class="hl kwd">metapost</span><span class="hl std">(widthPath,</span> <span class="hl str">&quot;width.mp&quot;</span><span class="hl std">)</span>
<span class="hl kwd">mpost</span><span class="hl std">(</span><span class="hl str">&quot;width.mp&quot;</span><span class="hl std">,</span> <span class="hl kwc">tracing</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl std">widthControls</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">mptrace</span><span class="hl std">(</span><span class="hl str">&quot;width.log&quot;</span><span class="hl std">)[[</span><span class="hl num">1</span><span class="hl std">]]</span>
<span class="hl std">w</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">BezierWidth</span><span class="hl std">(</span><span class="hl kwd">unit</span><span class="hl std">(widthControls</span><span class="hl opt">$</span><span class="hl std">y,</span> <span class="hl str">&quot;pt&quot;</span><span class="hl std">),</span>
                 <span class="hl kwc">d</span><span class="hl std">=widthControls</span><span class="hl opt">$</span><span class="hl std">x</span><span class="hl opt">/</span><span class="hl kwd">max</span><span class="hl std">(widthControls</span><span class="hl opt">$</span><span class="hl std">x))</span>
</pre></div>
</div></div>
<div class="chunk" id="unnamed-chunk-35"><div class="rimage default"><img src="figure/unnamed-chunk-35-1.png" title="plot of chunk unnamed-chunk-35" alt="plot of chunk unnamed-chunk-35" class="plot" /></div></div>
    <p>
    The code below applies that Bezier width spline to the infinity symbol.
  </p>
<div class="chunk" id="unnamed-chunk-36"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">options</span><span class="hl std">(</span><span class="hl kwc">metapost.units</span><span class="hl std">=</span><span class="hl str">&quot;mm&quot;</span><span class="hl std">)</span>
<span class="hl kwd">pushViewport</span><span class="hl std">(</span><span class="hl kwd">viewport</span><span class="hl std">(</span><span class="hl kwc">width</span><span class="hl std">=</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">),</span> <span class="hl kwc">height</span><span class="hl std">=</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl std">,</span> <span class="hl str">&quot;in&quot;</span><span class="hl std">)))</span>
<span class="hl kwd">metapost</span><span class="hl std">(p,</span> <span class="hl str">&quot;fig.mp&quot;</span><span class="hl std">)</span>
<span class="hl kwd">mpost</span><span class="hl std">(</span><span class="hl str">&quot;fig.mp&quot;</span><span class="hl std">,</span> <span class="hl kwc">tracing</span><span class="hl std">=</span><span class="hl num">TRUE</span><span class="hl std">)</span>
<span class="hl std">controls</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">mptrace</span><span class="hl std">(</span><span class="hl str">&quot;fig.log&quot;</span><span class="hl std">)[[</span><span class="hl num">1</span><span class="hl std">]]</span>
<span class="hl kwd">grid.offsetBezier</span><span class="hl std">(controls</span><span class="hl opt">$</span><span class="hl std">x, controls</span><span class="hl opt">$</span><span class="hl std">y,</span> <span class="hl kwc">default.units</span><span class="hl std">=</span><span class="hl str">&quot;pt&quot;</span><span class="hl std">,</span>
                  <span class="hl kwc">open</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">,</span>
                  <span class="hl kwc">w</span><span class="hl std">=w)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-36-1.png" title="plot of chunk unnamed-chunk-36" alt="plot of chunk unnamed-chunk-36" class="plot" /></div></div>
    <h2>
      <a name="summary">7. Summary</a>
    </h2>
    <p>
    The 'metapost' package provides functions (e.g., <code>knot</code>) 
    for describing a MetaPost
    path in R.  A MetaPost path description can be written to a MetaPost file
    using the <code>metapost</code> function.  A MetaPost file can
    be processed, to solve the path and produce PostScript output, 
    using the <code>mpost</code> function.  A solved MetaPost path
    (in the form of a log file produced by <code>mpost</code>) can be 
    read into R using the <code>mptrace</code> function.  A solved
    MetaPost path in R can be drawn using the <code>grid.metapost</code>
    function.
  </p>
    <p>
    Another way to generate a solved MetaPost path is using the 
    <code>mpsolve</code> function from the  'mplib' package 
    (although the 'mplib' package has complex system requirements).
  </p>
    <p>
    Another way to draw a solved MetaPost path in R is to import
    the PostScript output using the 'grImport' package.
  </p>
    <p>
    The diagram below attempts to show how these functions all relate
    to each other
    (the line around the top of the diagram below, from
    ".ps file" to <code>PostScriptTrace()</code>, was
    described using <code>knot</code> and 
    drawn using <code>grid.metapost</code>).
  </p>
    <p>
      <img src="diagram.svg">
    </p>
    <h2>
      <a name="discussion">8. discussion</a>
    </h2>
    <p>
    This report has described three main approaches to combining
    MetaPost with R, based on three packages: 'grImport', 'metapost', 
    and 'mplib'.  In this section, we discuss the reasons for 
    bothering with an R interface to MetaPost, and the reasons
    for bothering  with more than one approach.
  </p>
    <p>
    The main value of having an R interface to MetaPost has been demonstrated
    in the previous section:  we can combine the strengths of MetaPost's
    path description language with the strengths of R graphics (for 
    drawing plots).
  </p>
    <p>
    One benefit of the R tools for generating MetaPost paths
    (functions like <code>knot</code>) is that we can work more
    comfortably in R, writing R code rather than character values that
    contain MetaPost code.  It is also useful to have the general-purpose
    programming language facilities of R to generate paths.  For example,
    the following R code uses vectorisation to generate several paths
    at once.  
  </p>
<div class="chunk" id="unnamed-chunk-37"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">p</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl std">,</span> <span class="hl num">0</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">45</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">dir</span><span class="hl std">(</span><span class="hl num">0</span><span class="hl opt">:</span><span class="hl num">9</span><span class="hl opt">*-</span><span class="hl num">10</span><span class="hl std">)</span> <span class="hl opt">+</span> <span class="hl kwd">knot</span><span class="hl std">(</span><span class="hl kwd">unit</span><span class="hl std">(</span><span class="hl num">6</span><span class="hl std">,</span> <span class="hl str">&quot;cm&quot;</span><span class="hl std">),</span> <span class="hl num">0</span><span class="hl std">)</span>
<span class="hl kwd">grid.metapost</span><span class="hl std">(p)</span>
</pre></div>
</div><div class="rimage default"><img src="figure/unnamed-chunk-37-1.png" title="plot of chunk unnamed-chunk-37" alt="plot of chunk unnamed-chunk-37" class="plot" /></div></div>
    <p>
    This requires an explicit loop in MetaPost.
  </p>
    <pre>
beginfig(7)
for a=0 upto 9:
draw (0,0){dir 45}..{dir -10a}(6cm,0);
endfor
endfig;
  </pre>
    <p>
    One reason for having more than one interface between R and 
    MetaPost is flexibility.
    The design of the 'metapost' package (as shown in the diagram
    from the previous section) allows for the functions to be used
    in other ways than those described so far.
    For example, the 'grImport' package can import
    MetaPost output regardless of whether it was produced by 
    functions from the 'metapost' package.  Similarly, the <code>mpost</code>
    function can be used to run <code>mpost</code> on  a MetaPost file
    regardless of whether that file was generated by <code>metapost</code>.
    Finally, 
    <code>mptrace</code> can be used to read information from a 
    MetaPost log file regardless of whether the log file was produced 
    by functions from 'metapost'.
    The functions <code>mptrace</code> and <code>mpsolve</code> 
    are also designed to produce values (Bezier control points)
    that could be used by
    functions other than <code>grid.metapost</code> or
    <code>grid.mplib</code> (as demonstrated by the
    variable-width line examples in the <a href="#integrate">Integrating R and MetaPost graphics</a> Section).
  </p>
    <p>
    Another reason for choosing one MetaPost approach over another is
    the range of images that each approach supports.
    Both the 'metapost' and 'mplib' packages are focused on 
    just generating Bezier control points from a MetaPost path description.
    This means that there are limits on the sort of MetaPost image
    that can be described (there are limits on
    the sort of path description that is possible with
    functions like <code>knot</code>) and there are limits on
    the sort of MetaPost image that can be read into R.
    Further work could look at reducing these limits, though there will
    remain limits on what is possible with the 'mplib' approach
    because the MetaPost library API only exposes a subset of 
    the MetaPost features.
    The 'grImport' approach, by comparison, will handle any MetaPost
    image, including images that contain text.
  </p>
    <p>
    On the other hand, the path information that is returned by 
    <code>mptrace</code> and <code>mpsolve</code> is easier
    to work with and easier to combine with other graphical output
    than an image that was imported with 'grImport'.
    This is because the value returned by 
    <code>mptrace</code> and <code>mpsolve</code> is just the location
    of Bezier control points, whereas an imported image 
    is a path that may be embedded within the context of a larger image
    with other components.  This means that we may need to subset
    the imported image and/or be required to transform coordinates 
    to get the imported image to align with other graphical output.
  </p>
    <h2>
      <a name="requirements">9. Technical requirements</a>
    </h2>
    <p>
    The examples and discussion in this document relate to 
    <a href="https://github.com/pmur002/metapost/releases/tag/v1.0-0">version
    1.0-0</a> of the 'metapost' package, 
    <a href="https://github.com/pmur002/mplib/releases/tag/v1.0-0">version
    1.0-0</a> of the 'mplib' package, 
    <a href="https://github.com/pmur002/vwline/releases/tag/v0.2-1">version
    0.2-1</a> of the 'vwline' package, and
    <a href="https://github.com/pmur002/gridbezier/releases/tag/v1.0-0">version
    1.0-0</a> of the 'gridBezier' package.
  </p>
    <p>
    Installing 'mplib' requires a Docker container pmur002/mplib
    (the Docker container for
    this report will also suffice)
  </p>
    <p>
    This report was generated within a Docker container
    (see <a href="#Resources">Resources</a> section below).
  </p>
    <h2>
      <a name="Resources">10. Resources</a>
    </h2>
    <ul>
      <li>
      The <a href="mplib-package.cml">raw source file</a> for this
      report, a <a href="mplib-package.xml">valid XML</a>
      transformation of the source file, a <a href="mplib-package.Rhtml">'knitr' document</a> generated from
      the XML file, 
      two <a href="toc.R">R</a> <a href="bib.R">files</a> and
      the <a href="mplib-package.bib">bibtex file</a>
      that are used to generate the table of contents and reference sections,
      two <a href="common.xsl">XSL</a> <a href="knitr.xsl">files</a> and an 
      <a href="knit.R">R file</a> that are used to transform the XML to
      the 'knitr' document, and a <a href="Makefile">Makefile</a> that
      contains code for the other transformations and coordinates
      everything.  
      These materials are also available
      on <a href="https://github.com/pmur002/mplib-package-report/releases/tag/v1">github</a>.
    </li>
      <li>
      This report was generated within a 
      <a href="https://www.docker.com/">Docker</a> container.
      The Docker command to build the report is included in the Makefile above.
      The Docker image for the container is available from
      <a href="https://hub.docker.com/r/pmur002/mplib-package/">Docker Hub</a>;
      alternatively, the image can be rebuilt from its 
      <a href="Dockerfile">Dockerfile</a>.
    </li>
      <li>
      The 'grImport' package is avaiable from 
      <a href="http://cran.stat.auckland.ac.nz/web/packages/grImport/index.html">CRAN</a>
    </li>
      <li>
      The 'metapost' package is available on 
      <a href="https://github.com/pmur002/metapost">github</a>
    </li>
      <li>
      The 'mplib' package is available on 
      <a href="https://github.com/pmur002/mplib">github</a>
    </li>
    </ul>
    <h2>How to cite this document</h2>
    <p>
    Murrell, P. (2018). "MetaPost Three Ways" 
    Technical Report 2018-??, Department of Statistics, The University of Auckland. 
    [ <a href="how-to-cite.bib">bib</a> ] 
  </p>
    <h2>
      <a name="references">11. References</a>
    </h2>
    <dl>
<dt>
[<a name="context">Hagen, 2018</a>]
</dt>
<dd>
Hagen, H. (2018).
 <em>ConTeXt The Manual</em>.
[<a href="mplib-package-bib_bib.html#context">bib</a>| 
<a href="http://www.pragma-ade.com/general/manuals/cont-eni.pdf">.pdf</a>]

</dd>


<dt>
[<a name="metapost-hobby">Hobby, 1998</a>]
</dt>
<dd>
Hobby, J. (1998).
 A User's Manual for MetaPost.
[<a href="mplib-package-bib_bib.html#metapost-hobby">bib</a>]

</dd>


<dt>
[<a name="metapost">Hobby and the MetaPost development team, 2018</a>]
</dt>
<dd>
Hobby, J.D. and the MetaPost development team (2018).
 <em>METAPOST a users manual</em>.
[<a href="mplib-package-bib_bib.html#metapost">bib</a>| 
<a href="http://www.tug.org/docs/metapost/mpman.pdf">.pdf</a>]

</dd>


<dt>
[<a name="Hoekwater:TB28-3-317">Hoekwater and Hagen, 2007</a>]
</dt>
<dd>
Hoekwater, T. and Hagen, H. (2007).
 MPlib: MetaPost as a reusable component.
 <em>TUGboat</em>, 28(3):317--318.
[<a href="mplib-package-bib_bib.html#Hoekwater:TB28-3-317">bib</a>| 
<a href="http://www.tug.org/TUGboat/tb28-3/tb90hoekwater-mplib.pdf">.pdf</a>]

</dd>


<dt>
[<a name="mplibapi">Hoekwater and Scarso, 2018</a>]
</dt>
<dd>
Hoekwater, T. and Scarso, L. (2018).
 <em>MPlib API documentation, version 2.00</em>.
[<a href="mplib-package-bib_bib.html#mplibapi">bib</a>| 
<a href="http://mirror.aut.ac.nz/CTAN/systems/doc/metapost/mplibapi.pdf">.pdf</a>]

</dd>


<dt>
[<a name="murrell-mplib-library-2018">Murrell, 2018a</a>]
</dt>
<dd>
Murrell, P. (2018a).
 Building an mplib shared library.
 Technical Report 2018-10, Department of Statistics, The University of
  Auckland.
 version 1.
[<a href="mplib-package-bib_bib.html#murrell-mplib-library-2018">bib</a>]

</dd>


<dt>
[<a name="pkg:gridbezier">Murrell, 2018b</a>]
</dt>
<dd>
Murrell, P. (2018b).
 <em>gridBezier: Bezier Curves in grid</em>.
 R package version 1.0-0.
[<a href="mplib-package-bib_bib.html#pkg:gridbezier">bib</a>]

</dd>


<dt>
[<a name="pkg:vwline">Murrell, 2018c</a>]
</dt>
<dd>
Murrell, P. (2018c).
 <em>vwline: Draw variable-width lines</em>.
 R package version 0.2-0.
[<a href="mplib-package-bib_bib.html#pkg:vwline">bib</a>]

</dd>


<dt>
[<a name="R">R Core Team, 2018</a>]
</dt>
<dd>
R Core Team (2018).
 <em>R: A Language and Environment for Statistical Computing</em>.
 R Foundation for Statistical Computing, Vienna, Austria.
[<a href="mplib-package-bib_bib.html#R">bib</a>| 
<a href="https://www.R-project.org/">http</a>]

</dd>


<dt>
[<a name="pkg:lattice">Sarkar, 2008</a>]
</dt>
<dd>
Sarkar, D. (2008).
 <em>Lattice: Multivariate Data Visualization with R</em>.
 Springer, New York.
 ISBN 978-0-387-75968-5.
[<a href="mplib-package-bib_bib.html#pkg:lattice">bib</a>| 
<a href="http://lmdvr.r-forge.r-project.org">http</a>]

</dd>


<dt>
[<a name="luatex">The LuaTeX development team, 2017</a>]
</dt>
<dd>
The LuaTeX development team (2017).
 <em>LuaTeX Reference Manual</em>.
[<a href="mplib-package-bib_bib.html#luatex">bib</a>| 
<a href="http://www.luatex.org/svn/trunk/manual/luatex.pdf">.pdf</a>]

</dd>
</dl>
    <hr>
    <p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img class="CC" alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png"></a><br><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">This document</span>
    by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Paul
    Murrell</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative
    Commons Attribution 4.0 International License</a>.
  </p>
    <script>
  // Use async/await so that PDF files loaded one at a time
  async function loadPDFs() {
    var pdfcanvas = document.querySelectorAll("canvas.pdf");
    var i;
    for (i=0; i < pdfcanvas.length; i++) {
        var canvas = pdfcanvas[i];
        var canvasid = canvas.id;
        var pdf = await pdfjsLib.getDocument(canvasid + '.pdf');
        var page = await pdf.getPage(1);
        var scale = canvas.getAttribute("scale");
        if (!scale) {
            scale = 100/72;
        }
        var viewport = page.getViewport(scale);
        var context = canvas.getContext('2d');
        canvas.height = viewport.height;
        canvas.width = viewport.width;
        var renderContext = {
            canvasContext: context,
            viewport: viewport
        };
        page.render(renderContext);
    }
  }
  loadPDFs();
  </script>
  </body>
</html>
